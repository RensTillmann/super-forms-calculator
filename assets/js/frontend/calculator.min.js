


function run_count(selector, to) {
    var from = jQuery(selector).text() == '' ? 0 : parseFloat(jQuery(selector).find('.math_result').text());
    jQuery({
        someValue: from
    }).animate({
        someValue: parseFloat(to)
    }, {
        duration: 500,
        easing: 'swing',
        step: function() {
            jQuery(selector).find('.math_result').text(Math.ceil(this.someValue).toFixed(2));
        }
    });
    setTimeout(function() {
        jQuery(selector).find('.math_result').text(parseFloat(to).toFixed(2));

    }, 550);
}

function set_up_math_logic(target) {

    var get_math = target.attr('data-original-math-equation');
    var pattern = /\{(.*?)\}/g;
    while ((match = pattern.exec(get_math)) != null) {
        var element = document.getElementsByName(match[1]);
        jQuery(element).on('change',
            function() {
                run_math_logic(target);
            }
        );
    }
}



function run_math_logic(target) {

    if (!strstr(target.attr('data-math-equation'), '[')){
    	target.attr('data-math-equation', target.attr('data-original-math-equation'));
	}

    var get_math = target.attr('data-math-equation');
    var set_result = '';
    var match_array = []
    var pattern = /\{(.*?)\}/g;
    var set_val = '';
    var clean_math = '';
    var i = 0;
    var check_val = 0;
    var select_val = 0;

    while ((match = pattern.exec(get_math)) != null) {
        match_array[i] = match[1];
        i++;
    }

    var arrayLength = match_array.length;

    for (var j = 0; j < arrayLength; j++) {
        var set_match = match_array[j];
        var element = document.getElementsByName(match_array[j]);
        select_val = 0;
        check_val = 0;
        if (jQuery(element).is('select')) {
            jQuery('select[name="' + match_array[j] + '"] option:selected').each(
                function() {
                    if (jQuery(this).prop('selected') == true) {
                        if (jQuery(element).closest('.form_field').hasClass('multi-select'))
                            select_val += parseInt(jQuery(this).val());
                        else
                            select_val = parseInt(jQuery(this).val());
                    } else
                        select_val = 0;
                }
            );
            set_val = select_val;
        } else if (jQuery(element).attr('type') == 'checkbox') {
            jQuery('input[name="' + match_array[j] + '"]').each(
                function() {
                    if (jQuery(this).prop('checked') == true)
                        check_val += parseInt(jQuery(this).val());
                }
            );
            set_val = check_val;
        } else if (jQuery(element).attr('type') == 'radio') {
            if (jQuery('input[name="' + match_array[j] + '"]:checked').val())
                set_val = jQuery('input[name="' + match_array[j] + '"]:checked').val();
            else
                set_val = 0;
        } else if (jQuery(element).is('textarea')) {
            set_val = (jQuery('textarea[name="' + match_array[j] + '"]').val()) ? jQuery('textarea[name="' + match_array[j] + '"]').val() : 0;
        } else
            set_val = (jQuery(element).val()) ? jQuery(element).val() : 0;

        clean_math = target.attr('data-math-equation').replace(set_match, set_val).replace('{', '').replace('}', '');
        target.attr('data-math-equation', clean_math)
    }
    run_count(target, math.eval(clean_math));
    //target.parent().find('input.set_math_result').val(Math.ceil(math.eval(clean_math) * 100)/100);
    //For decimals
    target.parent().find('input.set_math_result').val((Math.ceil(math.eval(clean_math) * 100) / 100).toFixed(2));
}


SUPER.init_calculator_strstr = function( haystack, needle, bool ) {
	var pos = 0;
	haystack += "";
	pos = haystack.indexOf(needle); if (pos == -1) {
		return false;
	} else {
		return true;
	}
}


// Init Calculator
SUPER.init_calculator = function(){
	$('.super-calculator .super-calculator-wrapper').each(function(){
		var target = $(this);
		if (!SUPER.init_calculator_strstr(target.data('super-numeric-math'), '[')){
	    	target.data('super-numeric-math', target.data('super-math'));
		}
	    var get_math = target.data('super-math');
	    var set_result = '';
	    var pattern = /\{(.*?)\}/g;
	    var match_array = [];
	    var set_val = '';
		var clean_math = '';
		var check_val = 0;
		var select_val = 0;
		var i = 0;
	    while ((match = pattern.exec(get_math)) != null) {
	    	match_array[i] = match[1];
	    	i++;
	    }
	    var arrayLength = match_array.length;
		for (var j = 0; j < arrayLength; j++) {
	        var set_match = match_array[j];
	        var element = document.getElementsByName(match_array[j]);
	        select_val = 0;
	        check_val = 0;
	        if (jQuery(element).is('select')) {
	            jQuery('select[name="' + match_array[j] + '"] option:selected').each(
	                function() {
	                    if (jQuery(this).prop('selected') == true) {
	                        if (jQuery(element).closest('.form_field').hasClass('multi-select'))
	                            select_val += parseInt(jQuery(this).val());
	                        else
	                            select_val = parseInt(jQuery(this).val());
	                    } else
	                        select_val = 0;
	                }
	            );
	            set_val = select_val;
	        } else if (jQuery(element).attr('type') == 'checkbox') {
	            jQuery('input[name="' + match_array[j] + '"]').each(
	                function() {
	                    if (jQuery(this).prop('checked') == true)
	                        check_val += parseInt(jQuery(this).val());
	                }
	            );
	            set_val = check_val;
	        } else if (jQuery(element).attr('type') == 'radio') {
	            if (jQuery('input[name="' + match_array[j] + '"]:checked').val())
	                set_val = jQuery('input[name="' + match_array[j] + '"]:checked').val();
	            else
	                set_val = 0;
	        } else if (jQuery(element).is('textarea')) {
	            set_val = (jQuery('textarea[name="' + match_array[j] + '"]').val()) ? jQuery('textarea[name="' + match_array[j] + '"]').val() : 0;
	        } else
	            set_val = (jQuery(element).val()) ? jQuery(element).val() : 0;

	        clean_math = target.data('super-numeric-math').replace(set_match, set_val).replace('{', '').replace('}', '');
	        target.data('super-numeric-math', clean_math)
	    }
	    //console.log(clean_math);
	    //run_count(target, math.eval(clean_math));
	    //target.parent().find('input.set_math_result').val(Math.ceil(math.eval(clean_math) * 100)/100);
	    //For decimals
	    var amount = eval(clean_math); 
	    console.log(amount);
	    target.parent().find('.super-shortcode-field').val((Math.ceil(amount * 100) / 100).toFixed(2));

        //console.log(match);
        /*
        var element = document.getElementsByName(match[1]);
        jQuery(element).on('change',
            function() {
                run_math_logic(target);
            }
        );
        */



	    /*
	    while ((match = pattern.exec(get_math)) != null) {
	        
		    if (!SUPER.init_calculator_strstr(target.data('super-numeric-math'), '[')){
		    	target.data('super-numeric-math', target.data('super-math'));
			}
			console.log(target.data('super-numeric-math'));

			var get_math = target.data('super-numeric-math');
		    var set_result = '';
		    var match_array = [];
		    var set_val = '';
		    var clean_math = '';
		    var i = 0;
		    var check_val = 0;
		    var select_val = 0;
		    
		    console.log(pattern.exec(get_math));
		    /*
		    while ((match = pattern.exec(get_math)) != null) {
		        console.log(match[1]);
		        /*
				match_array[i] = match[1];
		        i++;
		    	*/
		    //}

		    /*
		    var arrayLength = match_array.length;

		    for (var j = 0; j < arrayLength; j++) {
		        var set_match = match_array[j];
		        var element = document.getElementsByName(match_array[j]);
		        select_val = 0;
		        check_val = 0;
		        if (jQuery(element).is('select')) {
		            jQuery('select[name="' + match_array[j] + '"] option:selected').each(
		                function() {
		                    if (jQuery(this).prop('selected') == true) {
		                        if (jQuery(element).closest('.form_field').hasClass('multi-select'))
		                            select_val += parseInt(jQuery(this).val());
		                        else
		                            select_val = parseInt(jQuery(this).val());
		                    } else
		                        select_val = 0;
		                }
		            );
		            set_val = select_val;
		        } else if (jQuery(element).attr('type') == 'checkbox') {
		            jQuery('input[name="' + match_array[j] + '"]').each(
		                function() {
		                    if (jQuery(this).prop('checked') == true)
		                        check_val += parseInt(jQuery(this).val());
		                }
		            );
		            set_val = check_val;
		        } else if (jQuery(element).attr('type') == 'radio') {
		            if (jQuery('input[name="' + match_array[j] + '"]:checked').val())
		                set_val = jQuery('input[name="' + match_array[j] + '"]:checked').val();
		            else
		                set_val = 0;
		        } else if (jQuery(element).is('textarea')) {
		            set_val = (jQuery('textarea[name="' + match_array[j] + '"]').val()) ? jQuery('textarea[name="' + match_array[j] + '"]').val() : 0;
		        } else
		            set_val = (jQuery(element).val()) ? jQuery(element).val() : 0;

		        clean_math = target.data('super-numeric-math').replace(set_match, set_val).replace('{', '').replace('}', '');
		        target.data('super-numeric-math', clean_math)
		    }
		    console.log(clean_math);
		    //run_count(target, math.eval(clean_math));
		    //target.parent().find('input.set_math_result').val(Math.ceil(math.eval(clean_math) * 100)/100);
		    //For decimals
		    //target.parent().find('.super-shortcode-field').val((Math.ceil(math.eval(clean_math) * 100) / 100).toFixed(2));


	        console.log(match);
	        /*
	        var element = document.getElementsByName(match[1]);
	        jQuery(element).on('change',
	            function() {
	                run_math_logic(target);
	            }
	        );
	        */
	    //}
		//console.log($math);
	});
}

jQuery(document).ready(function ($) {
    
    var $doc = $(document);

	/*
	SUPER.init_calculator();
	
	$doc.ajaxComplete(function() {
		SUPER.init_calculator();
	});
	*/

});


/*
function Person() {};
Person.prototype.speak = function() {
	alert('ohai');
};
var john = new Person,
	action = 'speak';

john[action]();
*/